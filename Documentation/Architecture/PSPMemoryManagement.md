# PSPå†…å­˜ç®¡ç†æ¶æ„è®¾è®¡

## æ¦‚è¿°

åŸºäº"HiNATAâ‰ˆè™šæ‹Ÿç¡¬ç›˜ï¼ŒPSPâ‰ˆè™šæ‹Ÿå†…å­˜"çš„æ ¸å¿ƒæ´å¯Ÿï¼Œæœ¬æ–‡æ¡£è¯¦ç»†è®¾è®¡PSPå†…å­˜ç®¡ç†å™¨ï¼Œç¡®ä¿åœ¨ä¸¥æ ¼çš„prompté•¿åº¦é™åˆ¶ä¸‹æœ€å¤§åŒ–ä¸ªæ€§åŒ–æ•ˆæœã€‚

## è®¾è®¡åŸç†

### æ ¸å¿ƒæŒ‘æˆ˜

**Prompté•¿åº¦é™åˆ¶**ï¼š
- GPT-4: 128K tokens (~96Kä¸­æ–‡å­—ç¬¦)
- Claude-3: 200K tokens (~150Kä¸­æ–‡å­—ç¬¦)  
- å…¶ä»–æ¨¡å‹: é€šå¸¸4K-32K tokens

**è®¾è®¡ç›®æ ‡**ï¼š
åœ¨æœ‰é™çš„PSP"å†…å­˜"ç©ºé—´å†…ï¼Œä»æµ·é‡HiNATA"ç¡¬ç›˜"æ•°æ®ä¸­æ™ºèƒ½ç­›é€‰å‡ºæœ€æœ‰ä»·å€¼çš„ä¸ªæ€§åŒ–ä¿¡æ¯ã€‚

## PSPå†…å­˜ç®¡ç†å™¨æ¶æ„

### 1. åˆ†å±‚å†…å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PSPè™šæ‹Ÿå†…å­˜ç®¡ç†                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CoreMemory (20%)                                            â”‚
â”‚ â€¢ é•¿æœŸç¨³å®šçš„æ ¸å¿ƒä¸ªæ€§åŒ–è§„åˆ™                                    â”‚
â”‚ â€¢ æ›´æ–°é¢‘ç‡: å¤©/å‘¨çº§åˆ«                                        â”‚
â”‚ â€¢ ç¤ºä¾‹: "ç”¨æˆ·åå¥½ç®€æ´ç›´æ¥çš„å›ç­”ï¼Œé¿å…å†—é•¿è§£é‡Š"                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WorkingMemory (40%)                                         â”‚
â”‚ â€¢ å½“å‰æ´»è·ƒçš„å·¥ä½œä¸Šä¸‹æ–‡å’Œåå¥½                                  â”‚
â”‚ â€¢ æ›´æ–°é¢‘ç‡: å°æ—¶çº§åˆ«                                         â”‚
â”‚ â€¢ ç¤ºä¾‹: "æœ€è¿‘å…³æ³¨Pythonå¼‚æ­¥ç¼–ç¨‹ï¼Œæ­£åœ¨è¿›è¡ŒWebå¼€å‘é¡¹ç›®"         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ContextMemory (30%)                                         â”‚
â”‚ â€¢ åŸºäºå½“å‰æŸ¥è¯¢çš„åŠ¨æ€ç›¸å…³ä¿¡æ¯                                  â”‚
â”‚ â€¢ æ›´æ–°é¢‘ç‡: æŸ¥è¯¢çº§åˆ«                                         â”‚
â”‚ â€¢ ç¤ºä¾‹: "ç”¨æˆ·åˆšåˆšæŸ¥è¯¢è¿‡Djangoï¼Œå¯èƒ½éœ€è¦ç›¸å…³æ¡†æ¶å¯¹æ¯”"          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BufferMemory (10%)                                          â”‚
â”‚ â€¢ æœ€æ–°è¡Œä¸ºæ•°æ®çš„å®æ—¶ç¼“å†²åŒº                                    â”‚
â”‚ â€¢ æ›´æ–°é¢‘ç‡: å®æ—¶                                            â”‚
â”‚ â€¢ ç¤ºä¾‹: "5åˆ†é’Ÿå‰åœ¨ReadItLateræ ‡è®°äº†æœºå™¨å­¦ä¹ æ–‡ç« "             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ™ºèƒ½å†…å®¹ç­›é€‰ç®—æ³•

#### ç»¼åˆè¯„åˆ†å…¬å¼

```python
def calculate_psp_score(hinata_item, current_context):
    """è®¡ç®—HiNATAé¡¹ç›®çš„PSPç›¸å…³æ€§è¯„åˆ†"""
    
    # é‡è¦æ€§è¯„åˆ† (0-1)
    importance_score = calculate_importance_score(hinata_item)
    
    # ç›¸å…³æ€§è¯„åˆ† (0-1) 
    relevance_score = calculate_semantic_similarity(
        hinata_item, current_context
    )
    
    # æ—¶æ•ˆæ€§è¯„åˆ† (0-1)
    freshness_score = calculate_freshness_score(hinata_item.timestamp)
    
    # é¢‘ç‡è¯„åˆ† (0-1)
    frequency_score = calculate_access_frequency(hinata_item.id)
    
    # åŠ æƒç»¼åˆè¯„åˆ†
    final_score = (
        importance_score * 0.3 +
        relevance_score * 0.35 + 
        freshness_score * 0.2 +
        frequency_score * 0.15
    )
    
    return final_score
```

#### é‡è¦æ€§è¯„åˆ†æœºåˆ¶

```python
def calculate_importance_score(hinata_item):
    """è®¡ç®—HiNATAé¡¹ç›®çš„é‡è¦æ€§è¯„åˆ†"""
    score = 0.5  # åŸºç¡€åˆ†
    
    # ç”¨æˆ·æ˜ç¡®æ ‡è®°
    if hinata_item.get('user_marked_important'):
        score += 0.3
    
    # ç”¨æˆ·ä¸»åŠ¨æ·»åŠ æ ‡ç­¾
    if len(hinata_item.get('tag', [])) > 2:
        score += 0.1
    
    # ç”¨æˆ·æ·»åŠ äº†è¯¦ç»†ç¬”è®°
    note_length = len(hinata_item.get('note', ''))
    if note_length > 100:
        score += min(0.2, note_length / 1000)
    
    # è¢«å¤šæ¬¡è®¿é—®
    access_count = get_access_count(hinata_item.id)
    if access_count > 1:
        score += min(0.1, access_count / 20)
    
    return min(1.0, score)
```

### 3. LRUæ›¿æ¢ç­–ç•¥

```python
class PSPMemoryManager:
    def __init__(self, max_tokens=50000):  # é¢„ç•™50K tokensç»™PSP
        self.max_tokens = max_tokens
        self.core_memory = LRUCache(max_tokens * 0.2)
        self.working_memory = LRUCache(max_tokens * 0.4) 
        self.context_memory = LRUCache(max_tokens * 0.3)
        self.buffer_memory = LRUCache(max_tokens * 0.1)
        
    def update_psp(self, query_context):
        """åŸºäºæŸ¥è¯¢ä¸Šä¸‹æ–‡åŠ¨æ€æ›´æ–°PSPå†…å®¹"""
        
        # 1. ä¿æŒCoreMemoryç¨³å®š
        # æ ¸å¿ƒè®°å¿†å¾ˆå°‘å˜åŒ–
        
        # 2. æ›´æ–°WorkingMemory
        relevant_patterns = self.find_relevant_patterns(query_context)
        self.working_memory.update(relevant_patterns)
        
        # 3. åŠ¨æ€åŠ è½½ContextMemory
        context_items = self.search_relevant_hinata(query_context)
        self.context_memory.clear()
        for item in context_items[:10]:  # é™åˆ¶æ•°é‡
            self.context_memory.put(item.id, item.compressed_content)
            
        # 4. æ›´æ–°BufferMemory
        recent_items = self.get_recent_hinata(minutes=10)
        self.buffer_memory.update(recent_items)
    
    def generate_psp(self):
        """ç”Ÿæˆæœ€ç»ˆçš„PSPæ–‡æœ¬"""
        psp_parts = []
        
        # æŒ‰é‡è¦æ€§é¡ºåºç»„è£…PSP
        psp_parts.append("## æ ¸å¿ƒä¸ªæ€§åŒ–è§„åˆ™")
        psp_parts.extend(self.core_memory.get_all())
        
        psp_parts.append("## å½“å‰å·¥ä½œä¸Šä¸‹æ–‡") 
        psp_parts.extend(self.working_memory.get_all())
        
        psp_parts.append("## ç›¸å…³èƒŒæ™¯ä¿¡æ¯")
        psp_parts.extend(self.context_memory.get_all())
        
        psp_parts.append("## æœ€æ–°è¡Œä¸ºæ•°æ®")
        psp_parts.extend(self.buffer_memory.get_all())
        
        final_psp = "\n".join(psp_parts)
        
        # ç¡®ä¿ä¸è¶…è¿‡tokené™åˆ¶
        return self.truncate_to_limit(final_psp)
```

### 4. é¢„æµ‹æ€§åŠ è½½æœºåˆ¶

```python
class PSPPredictiveLoader:
    def __init__(self, memory_manager):
        self.memory_manager = memory_manager
        self.pattern_recognizer = PatternRecognizer()
        
    def predict_relevant_content(self, query_context):
        """åŸºäºæŸ¥è¯¢ä¸Šä¸‹æ–‡é¢„æµ‹ç›¸å…³å†…å®¹"""
        
        # åˆ†ææŸ¥è¯¢æ¨¡å¼
        query_patterns = self.pattern_recognizer.analyze_query(query_context)
        
        # é¢„æµ‹ç›¸å…³é¢†åŸŸ
        related_domains = self.predict_related_domains(query_patterns)
        
        # é¢„å–ç›¸å…³HiNATAæ•°æ®
        predicted_items = []
        for domain in related_domains:
            domain_items = self.search_domain_hinata(domain, limit=5)
            predicted_items.extend(domain_items)
        
        # é¢„åŠ è½½åˆ°ContextMemory
        self.memory_manager.preload_context(predicted_items)
        
    def predict_related_domains(self, query_patterns):
        """åŸºäºæŸ¥è¯¢æ¨¡å¼é¢„æµ‹ç›¸å…³é¢†åŸŸ"""
        # ä½¿ç”¨è¯­ä¹‰å‘é‡å’Œå†å²æ¨¡å¼è¯†åˆ«ç›¸å…³é¢†åŸŸ
        # å®ç°ç•¥...
        pass
```

### 5. å†…å®¹å‹ç¼©ä¼˜åŒ–

```python
class ContentCompressor:
    def __init__(self):
        self.summarizer = LocalSummarizer()  # æœ¬åœ°æ‘˜è¦æ¨¡å‹
        
    def compress_hinata_content(self, hinata_item):
        """å‹ç¼©HiNATAå†…å®¹ï¼Œæé«˜ä¿¡æ¯å¯†åº¦"""
        
        original_note = hinata_item.get('note', '')
        highlight = hinata_item.get('highlight', '')
        
        # å¯¹é•¿å†…å®¹è¿›è¡Œæ™ºèƒ½æ‘˜è¦
        if len(original_note) > 200:
            # æå–å…³é”®ä¿¡æ¯
            key_points = self.extract_key_points(original_note)
            
            # ç”Ÿæˆç®€æ´æ‘˜è¦
            summary = self.summarizer.summarize(
                original_note, 
                max_length=100,
                focus_keywords=[highlight]
            )
            
            compressed_content = f"å…³é”®ç‚¹: {', '.join(key_points)}\næ‘˜è¦: {summary}"
        else:
            compressed_content = original_note
            
        return {
            'id': hinata_item['id'],
            'highlight': highlight,
            'compressed_content': compressed_content,
            'original_length': len(original_note),
            'compressed_length': len(compressed_content),
            'compression_ratio': len(compressed_content) / len(original_note)
        }
```

## å®ç°ä¼˜å…ˆçº§

### é˜¶æ®µä¸€ï¼šåŸºç¡€å†…å­˜ç®¡ç†å™¨
- [x] è®¾è®¡åˆ†å±‚å†…å­˜æ¶æ„
- [ ] å®ç°åŸºç¡€çš„LRUæ›¿æ¢ç®—æ³•
- [ ] å»ºç«‹tokenè®¡æ•°å’Œé™åˆ¶æœºåˆ¶
- [ ] å®ç°åŸºç¡€çš„é‡è¦æ€§è¯„åˆ†

### é˜¶æ®µäºŒï¼šæ™ºèƒ½ç­›é€‰ç®—æ³•  
- [ ] å®ç°è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—
- [ ] å»ºç«‹æ—¶æ•ˆæ€§è¯„åˆ†æœºåˆ¶
- [ ] å®ç°ç»¼åˆè¯„åˆ†ç®—æ³•
- [ ] ä¼˜åŒ–å†…å®¹ç­›é€‰æ•ˆæœ

### é˜¶æ®µä¸‰ï¼šé«˜çº§ä¼˜åŒ–
- [ ] å®ç°é¢„æµ‹æ€§åŠ è½½æœºåˆ¶
- [ ] é›†æˆæœ¬åœ°æ‘˜è¦æ¨¡å‹
- [ ] å»ºç«‹å‹ç¼©ä¼˜åŒ–ç®—æ³•
- [ ] å®ç°è‡ªé€‚åº”è°ƒä¼˜

### é˜¶æ®µå››ï¼šæ€§èƒ½ä¼˜åŒ–
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨æ•ˆç‡
- [ ] å®ç°æ‰¹é‡å¤„ç†æœºåˆ¶
- [ ] å»ºç«‹æ€§èƒ½ç›‘æ§æŒ‡æ ‡
- [ ] è¿›è¡Œå¤§è§„æ¨¡æµ‹è¯•éªŒè¯

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒç»„ä»¶
- **å†…å­˜ç®¡ç†**: Python + Redis (LRU Cache)
- **è¯­ä¹‰è®¡ç®—**: Sentence-Transformers + FAISS
- **å†…å®¹å‹ç¼©**: è½»é‡çº§Transformeræ‘˜è¦æ¨¡å‹
- **æ¨¡å¼è¯†åˆ«**: scikit-learn + è‡ªå®šä¹‰ç®—æ³•

### æ€§èƒ½æŒ‡æ ‡
- **PSPç”Ÿæˆå»¶è¿Ÿ**: < 100ms
- **å†…å­˜ä½¿ç”¨æ•ˆç‡**: > 80%
- **ä¸ªæ€§åŒ–å‡†ç¡®ç‡**: > 85%
- **tokenåˆ©ç”¨ç‡**: > 90%

## æ€»ç»“

é€šè¿‡å°†PSPè§†ä¸º"è™šæ‹Ÿå†…å­˜"å¹¶è®¾è®¡ä¸“é—¨çš„å†…å­˜ç®¡ç†å™¨ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸¥æ ¼çš„prompté•¿åº¦é™åˆ¶ä¸‹æœ€å¤§åŒ–ä¸ªæ€§åŒ–æ•ˆæœã€‚è¿™ä¸ªè®¾è®¡å€Ÿé‰´äº†æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†çš„æˆç†Ÿç†å¿µï¼Œä¸ºbyenatOSæä¾›äº†ä¸€ä¸ªå¯æ‰©å±•ã€é«˜æ•ˆçš„ä¸ªæ€§åŒ–å¤„ç†æ ¸å¿ƒã€‚

---

*è¿™ä¸ªè®¾è®¡ä½“ç°äº†byenatOSä½œä¸º"è™šæ‹Ÿæ“ä½œç³»ç»Ÿ"çš„æ ¸å¿ƒåˆ›æ–°ï¼šå°†ä¸ªæ€§åŒ–AIå¤„ç†æŠ½è±¡ä¸ºå†…å­˜ç®¡ç†é—®é¢˜ï¼Œå¹¶æä¾›ç³»ç»Ÿçº§çš„è§£å†³æ–¹æ¡ˆã€‚* ğŸ§ 